<!-- Map -->
<div class="results-wrapper">
  <div id="map"></div>

  <% if @search_widened %>
    <h2><%= @search_widened  %></h2>
  <% end %>

  <!-- Results Display -->
  <ul class="results-display">
    <% @runs.each do |run| %>
    <% photo_url = @user.photo? ? @user.photo : 'lix2bqmp4kzdpu4sqjiy' %>
      <li class="result">
        <div class="result-user">
          <%= cl_image_tag photo_url, height: 80, width: 80, crop: :thumb %>
        </div>
        <div class="result-description">
          <h4><%= link_to run.description.upcase, run_path(run) %></h4>
          <h4>HOSTED BY <%= @user.first_name.upcase %></h4>
        </div>
        <div class="result-details">
          <p><%= run.location.upcase.match(/^(.+?),/).to_s %> <%= run.location.upcase.match(/,\s*([^,]+)$/).to_s.gsub(", ","") %></p>
          <p><%= run.run_distance %> KM</p>
        </div>
      </li>
    <% end %>
  </ul>

</div>

<!-- JavaScript -->
<% content_for(:after_js) do %>
  <script>
    <!-- Map Display -->
    const handler = Gmaps.build('Google');
    handler.buildMap({ internal: { id: 'map' } }, function() {
      markers = handler.addMarkers(<%= raw @coordinates.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
      if (markers.length == 0) {
        handler.getMap().setZoom(2);
      } else if (markers.length == 1) {
        handler.getMap().setZoom(14);
      }
    });
  </script>
<% end %>
